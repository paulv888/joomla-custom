!function(a){a.fn.highchartTable=function(){var i=["column","line","area","spline","pie","scatter"],r=function(e,t){var i=a(e).data(t);if("undefined"!=typeof i){for(var r=i.split("."),n=window[r[0]],d=1,l=r.length;l>d;d++)n=n[r[d]];return n}};return this.each(function(){var n,d=a(this),l=a(d),s=1,p=a("caption",d),o=p.length?a(p[0]).text():"";if(1!=l.data("graph-container-before")){var h=l.data("graph-container");if(!h)throw"graph-container data attribute is mandatory";if("#"===h[0]||-1===h.indexOf(".."))n=a(h);else{for(var g=d,f=h;-1!==f.indexOf("..");)f=f.replace(/^.. /,""),g=g.parent();n=a(f,g)}if(1!==n.length)throw"graph-container is not available in this DOM or available multiple times";n=n[0]}else l.before("<div></div>"),n=l.prev(),n=n[0];var u=l.data("graph-type");if(!u)throw"graph-type data attribute is mandatory";if(-1==a.inArray(u,i))throw"graph-container data attribute must be one of "+i.join(", ");var c=l.data("graph-stacking");c||(c="normal");var x=l.data("graph-datalabels-enabled"),y=1==l.data("graph-inverted"),b=a("thead th",d),m=[],v=[],k=0,w=!1;b.each(function(e,t){var r=a(t),n=r.data("graph-value-scale"),d=r.data("graph-type");-1==a.inArray(d,i)&&(d=u);var p=r.data("graph-stack-group");p&&(w=!0);var o=r.data("graph-datalabels-enabled");"undefined"==typeof o&&(o=x);var h=r.data("graph-markers-enabled");"undefined"==typeof h&&(h=!1);var g=r.data("graph-yaxis");"undefined"!=typeof g&&"1"==g&&(s=2);var f=1==r.data("graph-skip");f&&(k+=1);var c={libelle:r.text(),skip:f,indexTd:e-k-1,color:r.data("graph-color"),visible:!r.data("graph-hidden"),yAxis:"undefined"!=typeof g?g:0,dashStyle:r.data("graph-dash-style")||"solid",dataLabelsEnabled:1==o,markersEnabled:h,dataLabelsColor:r.data("graph-datalabels-color")||l.data("graph-datalabels-color")},b=r.data("graph-vline-x");"undefined"==typeof b?(c.scale="undefined"!=typeof n?parseFloat(n):1,c.graphType="column"==d&&y?"bar":d,c.stack=p,c.unit=r.data("graph-unit"),m[e]=c):(c.x=b,c.height=r.data("graph-vline-height"),c.name=r.data("graph-vline-name"),v[e]=c)});var L=l.data("graph-marker-radius")||2,T=[];a(m).each(function(a,e){if(0!=a&&!e.skip){var t={name:e.libelle+(e.unit?" ("+e.unit+")":""),data:[],type:e.graphType,stack:e.stack,color:e.color,visible:e.visible,yAxis:e.yAxis,dashStyle:e.dashStyle,marker:{enabled:e.markersEnabled,radius:L,lineColor:e.color,lineWidth:3},dataLabels:{enabled:e.dataLabelsEnabled,color:e.dataLabelsColor,align:l.data("graph-datalabels-align")||("column"==u&&1==y?void 0:"center")}};if(e.dataLabelsEnabled){var i=r(d,"graph-datalabels-formatter");i&&(t.dataLabels.formatter=function(){return i(this.y)})}T.push(t)}}),a(v).each(function(a,e){"undefined"==typeof e||e.skip||T.push({name:e.libelle,data:[{x:e.x,y:0,name:e.name},{x:e.x,y:e.height,name:e.name}],type:"spline",color:e.color,visible:e.visible,marker:{enabled:!1}})});var A=[],I=r(d,"graph-point-callback"),O="datetime"==l.data("graph-xaxis-type"),C=a("tbody:first tr",d);C.each(function(e,i){if(!a(i).data("graph-skip")&&"undefined"!=typeof a(i).attr("id")){var r=a("td",i);r.each(function(e,r){var n,d=m[e];if(!d.skip){var l=a(r);if(0==e)n=l.text(),A.push(n);else{var s=l.text(),p=T[d.indexTd],o=s.replace(/\s/g,"").replace(/,/,".");if(0==o.length)O||p.data.push(null);else{n=Math.round(parseFloat(o)*d.scale*100)/100;var h=l.data("graph-x");if(O){h=a("td",a(i)).first().text();var g=t(h);h=g.getTime()-60*g.getTimezoneOffset()*1e3}var f=l.data("graph-name"),u={name:"undefined"!=typeof f?f:n,y:n,x:h};I&&(u.events={click:function(){return I(this)}}),"pie"===d.graphType&&l.data("graph-item-highlight")&&(u.sliced=1);var c=l.data("graph-item-color");"undefined"!=typeof c&&(u.color=c),isNaN(n)||p.data.push(u)}}}})}});var D,H=[];for(D=1;s>=D;D++){var S={title:{text:"undefined"!=typeof l.data("graph-yaxis-"+D+"-title-text")?l.data("graph-yaxis-"+D+"-title-text"):null},max:"undefined"!=typeof l.data("graph-yaxis-"+D+"-max")?l.data("graph-yaxis-"+D+"-max"):null,min:"undefined"!=typeof l.data("graph-yaxis-"+D+"-min")?l.data("graph-yaxis-"+D+"-min"):null,reversed:"1"==l.data("graph-yaxis-"+D+"-reversed"),opposite:"1"==l.data("graph-yaxis-"+D+"-opposite"),tickInterval:l.data("graph-yaxis-"+D+"-tick-interval")||null,labels:{rotation:l.data("graph-yaxis-"+D+"-rotation")||0},startOnTick:"0"!==l.data("graph-yaxis-"+D+"-start-on-tick"),endOnTick:"0"!==l.data("graph-yaxis-"+D+"-end-on-tick"),stackLabels:{enabled:"1"==l.data("graph-yaxis-"+D+"-stacklabels-enabled")},gridLineInterpolation:l.data("graph-yaxis-"+D+"-grid-line-interpolation")||null},z=r(d,"graph-yaxis-"+D+"-formatter-callback");z&&(S.labels.formatter=function(){return z(this.value)}),H.push(S)}for(var E=["#4572A7","#AA4643","#89A54E","#DB843D","#92A8CD","#A47D7C","#3D96AE","#80699B","#B5CA92"],M=[],W="undefined"!=typeof Highcharts.theme&&"undefined"!=typeof Highcharts.theme.colors?Highcharts.theme.colors:[],B=l.data("graph-line-shadow"),F=l.data("graph-line-width")||2,N=0;9>N;N++){var P="graph-color-"+(N+1);M.push("undefined"!=typeof l.data(P)?l.data(P):"undefined"!=typeof W[N]?W[N]:E[N])}var j=l.data("graph-margin-top"),G=l.data("graph-margin-right"),R=l.data("graph-margin-bottom"),Q=l.data("graph-margin-left"),Y=l.data("graph-xaxis-labels-enabled"),_={},q=l.data("graph-xaxis-labels-font-size");"undefined"!=typeof q&&(_.fontSize=q);var J={colors:M,chart:{renderTo:n,inverted:y,marginTop:"undefined"!=typeof j?j:null,marginRight:"undefined"!=typeof G?G:null,marginBottom:"undefined"!=typeof R?R:null,marginLeft:"undefined"!=typeof Q?Q:null,spacingTop:l.data("graph-spacing-top")||10,height:l.data("graph-height")||null,zoomType:l.data("graph-zoom-type")||null,polar:l.data("graph-polar")||null},title:{text:o},subtitle:{text:l.data("graph-subtitle-text")||""},legend:{enabled:"1"!=l.data("graph-legend-disabled"),layout:l.data("graph-legend-layout")||"horizontal",symbolWidth:l.data("graph-legend-width")||30,x:l.data("graph-legend-x")||15,y:l.data("graph-legend-y")||0},xAxis:{categories:"datetime"!=l.data("graph-xaxis-type")?A:void 0,type:"datetime"==l.data("graph-xaxis-type")?"datetime":void 0,reversed:"1"==l.data("graph-xaxis-reversed"),opposite:"1"==l.data("graph-xaxis-opposite"),showLastLabel:"undefined"!=typeof l.data("graph-xaxis-show-last-label")?l.data("graph-xaxis-show-last-label"):!0,tickInterval:l.data("graph-xaxis-tick-interval")||null,dateTimeLabelFormats:{second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%b-%e",week:"%b-%e",month:"%b '%y",year:"%Y"},labels:{rotation:l.data("graph-xaxis-rotation")||0,align:l.data("graph-xaxis-align")||"center",enabled:"undefined"!=typeof Y?Y:!0,style:_},startOnTick:l.data("graph-xaxis-start-on-tick"),endOnTick:l.data("graph-xaxis-end-on-tick"),min:e(d,"min"),max:e(d,"max"),alternateGridColor:l.data("graph-xaxis-alternateGridColor")||null,title:{text:l.data("graph-xaxis-title-text")||null},gridLineWidth:l.data("graph-xaxis-gridLine-width")||0,gridLineDashStyle:l.data("graph-xaxis-gridLine-style")||"ShortDot",tickmarkPlacement:l.data("graph-xaxis-tickmark-placement")||"between",lineWidth:l.data("graph-xaxis-line-width")||0},yAxis:H,tooltip:{formatter:function(){if("datetime"==l.data("graph-xaxis-type"))return"<b>"+this.series.name+"</b><br/>"+Highcharts.dateFormat("%b-%e %H:%M:%S",this.x)+" : "+this.y;var a="undefined"!=typeof A[this.point.x]?A[this.point.x]:this.point.x;return"pie"===u?"<strong>"+this.series.name+"</strong><br />"+a+" : "+this.point.y:"<strong>"+this.series.name+"</strong><br />"+a+" : "+this.point.name}},credits:{enabled:!1},plotOptions:{scatter:{dataLabels:{enabled:!0,verticalAlign:"middle"}},line:{dataLabels:{enabled:!0},lineWidth:F},area:{lineWidth:F,shadow:"undefined"!=typeof B?B:!0,fillOpacity:l.data("graph-area-fillOpacity")||.75},pie:{allowPointSelect:!0,dataLabels:{enabled:!0},showInLegend:"1"==l.data("graph-pie-show-in-legend"),size:"80%"},series:{animation:!1,stickyTracking:!1,stacking:w?c:null,groupPadding:l.data("graph-group-padding")||0}},series:T,exporting:{filename:o.replace(/ /g,"_"),buttons:{exportButton:{menuItems:null,onclick:function(){this.exportChart()}}}}};l.trigger("highchartTable.beforeRender",J),new Highcharts.Chart(J)}),this};var e=function(e,i){var r=a(e).data("graph-xaxis-"+i);if("undefined"!=typeof r){if("datetime"==a(e).data("graph-xaxis-type")){var n=t(r);return n.getTime()-60*n.getTimezoneOffset()*1e3}return r}return null},t=function(a){var e=a.split(" "),t=e[0].split("-"),i=null,r=null,n=null;if(e[1]){var d=e[1].split(":");n=parseInt(d[0],10),r=parseInt(d[1],10),i=parseInt(d[2],10)}return isNaN(i)?new Date(parseInt(t[0],10),parseInt(t[1],10)-1,parseInt(t[2],10),n,r):new Date(parseInt(t[0],10),parseInt(t[1],10)-1,parseInt(t[2],10),n,r,i)}}(jQuery);